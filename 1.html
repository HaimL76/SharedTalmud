<html>

<head>
    <script src="jquery-3.6.0.js"></script>
    <script>
        $(document).ready(function() {
            //var design = $(this).attr('data-design');
            //var id = $(this).attr('id');
            var canvas = $("#page-image")[0];

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            var ctx = canvas.getContext("2d");
            var img = new Image;
            img.onload = function() {
                ctx.drawImage(this, 0, 0);
            };
            img.src = 'featured-image-backyard-landscaping.jpeg';

            $('#page-image').mousemove(function(e) {
                const left = $("#page-image").position().left;
                const top = $("#page-image").position().top;

                row = e.pageY - top;
                col = e.pageX - left;

                $('#dynamic-status').val(col + ', ' + row);
            });

            $("#page-image").dblclick(function(e) {
                const left = $("#page-image").position().left;
                const top = $("#page-image").position().top;

                row = e.pageY - top;
                col = e.pageX - left;

                $('#static-status').val(col + ', ' + row);

                insert(row, col);

                let i = 10;

                const centerX = col;
                const centerY = row;

                var myInterval = setInterval(() => {
                        var canvas = $("#page-image")[0];
                        const context = canvas.getContext('2d');
                        //const centerX = canvas.width / 2;
                        //const centerY = canvas.height / 2;

                        //context.clearRect(0, 0, canvas.width, canvas.height);

                        const radius = 70;

                        alpha = (i / 10) * 255;
                        i--;

                        str_rgba = `rgba(0, 255, 255, ${alpha})`;

                        context.beginPath();
                        context.arc(centerX, centerY, radius, 0, 2 * Math.PI, false);
                        context.fillStyle = str_rgba;
                        context.fill();
                        context.lineWidth = 5;
                        context.strokeStyle = '#003300';
                        context.stroke();

                        if (i < 1)
                            clearInterval(myInterval);
                    },
                    1000);
            });

            const insert = function(row, col) {
                //alert("Hello, world!");

                $.ajax({
                    type: "POST",
                    url: `http://localhost:3000/${row}/${col}`,
                    success: function(data) {
                        console.log(data.toString);

                        alert(JSON.stringify(data));
                    }
                });
            };
            /*
                        const canvas = $('#canvi')[0]; // 

                        //canvas.width = 800;
                        //canvas.height = 600;

                        //const canvas = document.getElementById("canvi");

                        const context = canvas.getContext('2d');

                        const image = new Image();

                        image.src = "featured-image-backyard-landscaping.jpeg"; // can also be a remote URL e.g. http://

                        image.onload = function() {
                            canvas.height = image.height;
                            canvas.width = image.width;

                            context.drawImage(image, 0, 0);
                        };
                        */
        })
    </script>
</head>
<style>
    /*
    #page-image {
        position: absolute;
        top: 0px;
        left: 0px;
    }
    
    input[type=text] {
        position: absolute;
        top: 500px;
    }
    */
    
    .super-container {
        display: flex;
        flex-direction: row;
        position: absolute;
        top: 0px;
        left: 0px;
    }
    
    .container {
        display: flex;
        flex-direction: column;
    }
</style>

<body>
    <div class="super-container">
        <input type="text" id="dynamic-status" />
        <input type="text" id="static-status" />

        <div class="container">
            <!--<img id="page-image" src="featured-image-backyard-landscaping.jpeg" alt="featured-image-backyard-landscaping.jpeg">-->
            <canvas id="page-image"><!--</canvas> width="200" height="100" style="border:1px solid #000000;">-->
            </canvas>
        </div>
    </div>
    <!--<canvas id="canvi" />-->
</body>

</html>